% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compfit.R
\name{compfit}
\alias{compfit}
\title{Compare Multiple Regression Models}
\usage{
compfit(
  data,
  outcome,
  model_list,
  model_names = NULL,
  interactions_list = NULL,
  model_type = "auto",
  family = "binomial",
  conf_level = 0.95,
  p_digits = 3,
  include_coefficients = FALSE,
  scoring_weights = NULL,
  labels = NULL,
  ...
)
}
\arguments{
\item{data}{A data.frame or data.table containing the dataset.}

\item{outcome}{Character string specifying the outcome variable. For survival
analysis, use Surv() syntax (e.g., "Surv(time, status)").}

\item{model_list}{List of character vectors, each containing predictor names
for one model. Can also be a single character vector to auto-generate nested models.}

\item{model_names}{Character vector of names for each model. If NULL, uses
"Model 1", "Model 2", etc. Default is NULL.}

\item{interactions_list}{List of character vectors specifying interaction
terms for each model. Each element corresponds to one model in model_list.
Use NULL for models without interactions. Use colon notation for interactions
(e.g., c("age:treatment")). If NULL, no interactions are added to any model.
Default is NULL.}

\item{model_type}{Character string specifying model type. If "auto", detects
based on outcome. Options: "auto", "glm", "lm", "coxph", "clogit".
Default is "auto".}

\item{family}{For GLM models, the error distribution family. Default is "binomial".}

\item{conf_level}{Numeric confidence level for intervals. Default is 0.95.}

\item{p_digits}{Integer specifying the number of decimal places for p-values.
P-values smaller than \code{10^(-p_digits)} are displayed as "< 0.001"
(for \code{p_digits = 3}), "< 0.0001" (for \code{p_digits = 4}), etc.
Default is 3.}

\item{include_coefficients}{Logical. If TRUE, includes a second table with
coefficient estimates. Default is FALSE.}

\item{scoring_weights}{Named list of scoring weights. Each weight should be
between 0 and 1, and they should sum to 1. Available metrics depend on model
type. If NULL, uses sensible defaults. See Details for available metrics.}

\item{labels}{Named character vector for custom variable labels. Default is NULL.}

\item{...}{Additional arguments passed to model fitting functions.}
}
\value{
A data.table with class "compfit_result" containing:
  \describe{
    \item{Model}{Model name/identifier}
    \item{Summata Score}{Composite metric for model selection (higher is better)}
    \item{N}{Sample size}
    \item{Events}{Number of events (for survival/logistic)}
    \item{Predictors}{Number of predictors}
    \item{Converged}{Whether model converged properly}
    \item{AIC}{Akaike Information Criterion}
    \item{BIC}{Bayesian Information Criterion}
    \item{Pseudo-RÂ²}{McFadden's pseudo-R-squared (GLM)}
    \item{Concordance}{C-statistic (logistic/survival)}
    \item{Brier Score}{Brier accuracy score (logistic)}
    \item{Global p}{Overall model p-value}
  }
  
  Attributes include:
  \describe{
    \item{models}{List of fitted model objects}
    \item{coefficients}{Coefficient comparison table (if requested)}
    \item{best_model}{Name of recommended model}
  }
}
\description{
Fits multiple regression models and provides a comprehensive comparison table
with model quality metrics, convergence diagnostics, and selection guidance.
Computes a composite score combining multiple quality metrics to facilitate 
rapid model comparison and selection.
}
\details{
This function fits all specified models and computes comprehensive quality
metrics for comparison. It generates a composite score (Summata Score) that 
combines multiple metrics: lower AIC/BIC (information criteria), higher 
concordance (discrimination), and model convergence status.

For GLMs, McFadden's pseudo-R-squared is calculated as 1 - (logLik/logLik_null).
For survival models, the global p-value comes from the log-rank test.

Models that fail to converge are flagged and penalized in the composite score.

\strong{Interaction Terms:}

When \code{interactions_list} is provided, each element specifies the
interaction terms for the corresponding model in \code{model_list}. This is
particularly useful for testing whether adding interactions improves model fit:
\itemize{
  \item Use NULL for models without interactions
  \item Specify interactions using colon notation: c("age:treatment", "sex:stage")
  \item Main effects for all variables in interactions must be in the predictor list
  \item Common pattern: Compare main effects model vs model with interactions
}

Scoring weights can be customized based on model type:
\itemize{
  \item GLM: "convergence", "aic", "concordance", "pseudo_r2", "brier" 
  \item Cox: "convergence", "aic", "concordance", "global_p"
  \item Linear: "convergence", "aic", "pseudo_r2", "rmse"
}
Default weights emphasize discrimination (concordance) and model fit (AIC).

The composite score is designed as a tool to quickly rank models by their 
quality metrics. It should be used alongside traditional model selection 
criteria rather than as a definitive selection method.
}
\examples{
# Load example data
data(clintrial)
data(clintrial_labels)

# Example 1: Compare nested logistic regression models
models <- list(
    base = c("age", "sex"),
    clinical = c("age", "sex", "smoking", "diabetes"),
    full = c("age", "sex", "smoking", "diabetes", "stage", "ecog")
)

comparison <- compfit(
    data = clintrial,
    outcome = "os_status",
    model_list = models,
    model_names = c("Base", "Clinical", "Full")
)
comparison

# Example 2: Compare Cox survival models
library(survival)
surv_models <- list(
    simple = c("age", "sex"),
    clinical = c("age", "sex", "stage", "grade")
)

surv_comparison <- compfit(
    data = clintrial,
    outcome = "Surv(os_months, os_status)",
    model_list = surv_models,
    model_type = "coxph"
)
surv_comparison

# Example 3: Test effect of adding interaction terms
interaction_models <- list(
    main = c("age", "treatment", "sex"),
    interact = c("age", "treatment", "sex")
)

interaction_comp <- compfit(
    data = clintrial,
    outcome = "os_status",
    model_list = interaction_models,
    model_names = c("Main Effects", "With Interaction"),
    interactions_list = list(
        NULL,
        c("treatment:sex")
    )
)
interaction_comp

# Example 4: Include coefficient comparison table
detailed <- compfit(
    data = clintrial,
    outcome = "os_status",
    model_list = models,
    include_coefficients = TRUE,
    labels = clintrial_labels
)

# Access coefficient table
coef_table <- attr(detailed, "coefficients")
coef_table

# Example 5: Access fitted model objects
fitted_models <- attr(comparison, "models")
names(fitted_models)

# Example 6: Get best model recommendation
best <- attr(comparison, "best_model")
cat("Recommended model:", best, "\n")

}
\seealso{
\code{\link{fit}} for individual model fitting,
\code{\link{fullfit}} for automated variable selection,
\code{\link{table2pdf}} for exporting results
}
